"use strict";

var _createClass = (function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ("value" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; })();

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }

var __decorate = undefined && undefined.__decorate || function (decorators, target, key, desc) {
    var c = arguments.length,
        r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc,
        d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = undefined && undefined.__metadata || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var aurelia_framework_1 = require('aurelia-framework');
var aurelia_router_1 = require('aurelia-router');
var aurelia_adal_manager_1 = require('./aurelia-adal-manager');
var AureliaAdalAuthorizeStep = (function () {
    function AureliaAdalAuthorizeStep(aureliaAdal) {
        _classCallCheck(this, AureliaAdalAuthorizeStep);

        this.aureliaAdal = aureliaAdal;
    }

    _createClass(AureliaAdalAuthorizeStep, [{
        key: "run",
        value: function run(routingContext, next) {
            var _this = this;

            var hash = window.location.hash;
            return this.aureliaAdal.hashHandler(hash, function (url) {
                // Was callback
                return next.cancel(new aurelia_router_1.Redirect(url));
            }, function () {
                // Was not callback
                var loginRoute = ''; // TODO: get login url from aureliaAdal
                if (routingContext.getAllInstructions().some(function (i) {
                    return !!i.config.settings.requireAdalLogin;
                })) {
                    if (!_this.aureliaAdal.isAuthenticated()) {
                        // Not logged in, redirect to login route
                        return _this.aureliaAdal.loginHandler(routingContext.fragment, function (url) {
                            return next.cancel(new aurelia_router_1.Redirect(url));
                        }, function () {
                            return next.cancel('login redirect');
                        });
                    }
                } else if (_this.aureliaAdal.isAuthenticated() && routingContext.getAllInstructions().some(function (i) {
                    return i.fragment == loginRoute;
                })) {
                    // Logged in, current route is the login route
                    var loginRedirect = '';
                    return next.cancel(new aurelia_router_1.Redirect(loginRedirect));
                }
                return next();
            }, function () {
                return next();
            });
        }
    }]);

    return AureliaAdalAuthorizeStep;
})();
AureliaAdalAuthorizeStep = __decorate([aurelia_framework_1.inject(aurelia_adal_manager_1.AureliaAdalManager), __metadata('design:paramtypes', [aurelia_adal_manager_1.AureliaAdalManager])], AureliaAdalAuthorizeStep);
exports.AureliaAdalAuthorizeStep = AureliaAdalAuthorizeStep;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImF1cmVsaWEtYWRhbC1hdXRob3JpemUtc3RlcC5qcyIsImF1cmVsaWEtYWRhbC1hdXRob3JpemUtc3RlcC50cyJdLCJuYW1lcyI6WyJBdXJlbGlhQWRhbEF1dGhvcml6ZVN0ZXAiLCJBdXJlbGlhQWRhbEF1dGhvcml6ZVN0ZXAuY29uc3RydWN0b3IiLCJBdXJlbGlhQWRhbEF1dGhvcml6ZVN0ZXAucnVuIl0sIm1hcHBpbmdzIjoiOzs7Ozs7QUFBQSxJQUFJLFVBQVUsR0FBRyxBQUFDLGFBQVEsVUFBSyxVQUFVLElBQUssVUFBVSxVQUFVLEVBQUUsTUFBTSxFQUFFLEdBQUcsRUFBRSxJQUFJLEVBQUU7QUFDbkYsUUFBSSxDQUFDLEdBQUcsU0FBUyxDQUFDLE1BQU07UUFBRSxDQUFDLEdBQUcsQ0FBQyxHQUFHLENBQUMsR0FBRyxNQUFNLEdBQUcsSUFBSSxLQUFLLElBQUksR0FBRyxJQUFJLEdBQUcsTUFBTSxDQUFDLHdCQUF3QixDQUFDLE1BQU0sRUFBRSxHQUFHLENBQUMsR0FBRyxJQUFJO1FBQUUsQ0FBQyxDQUFDO0FBQzdILFFBQUksT0FBTyxPQUFPLEtBQUssUUFBUSxJQUFJLE9BQU8sT0FBTyxDQUFDLFFBQVEsS0FBSyxVQUFVLEVBQUUsQ0FBQyxHQUFHLE9BQU8sQ0FBQyxRQUFRLENBQUMsVUFBVSxFQUFFLE1BQU0sRUFBRSxHQUFHLEVBQUUsSUFBSSxDQUFDLENBQUMsS0FDMUgsS0FBSyxJQUFJLENBQUMsR0FBRyxVQUFVLENBQUMsTUFBTSxHQUFHLENBQUMsRUFBRSxDQUFDLElBQUksQ0FBQyxFQUFFLENBQUMsRUFBRSxFQUFFLElBQUksQ0FBQyxHQUFHLFVBQVUsQ0FBQyxDQUFDLENBQUMsRUFBRSxDQUFDLEdBQUcsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDLENBQUMsR0FBRyxDQUFDLEdBQUcsQ0FBQyxHQUFHLENBQUMsQ0FBQyxNQUFNLEVBQUUsR0FBRyxFQUFFLENBQUMsQ0FBQyxHQUFHLENBQUMsQ0FBQyxNQUFN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SUEsRUFBRUEsQ0FBQ0E7YUFDZkEsQ0FBQ0EsQ0FBQ0E7U0FDTkE7Ozs7SUFDRkYsQ0FBQUE7QUFyQ0Qsd0JBQUEsR0FBQSxVQUFBLENBQUEsQ0FBQyxtQkFBQSxDQUFBLE1BQU0sQ0FBQyxzQkFBQSxDQUFBLGtCQUFrQixDQUFDLEVEMkN2QixVQUFVLENBQUMsbUJBQW1CLEVBQUUsQ0FBQyxzQkFBc0IsQ0FBQyxrQkFBa0IsQ0FBQyxDQUFDLENBQy9FLEVBQUUsd0JBQXdCLENBQUMsQ0NQM0I7QUFwQ1ksT0FBQSxDQUFBLHdCQUF3QixHQUFBLHdCQW9DcEMsQ0FBQSIsImZpbGUiOiJhdXJlbGlhLWFkYWwtYXV0aG9yaXplLXN0ZXAuanMiLCJzb3VyY2VzQ29udGVudCI6WyJ2YXIgX19kZWNvcmF0ZSA9ICh0aGlzICYmIHRoaXMuX19kZWNvcmF0ZSkgfHwgZnVuY3Rpb24gKGRlY29yYXRvcnMsIHRhcmdldCwga2V5LCBkZXNjKSB7XG4gICAgdmFyIGMgPSBhcmd1bWVudHMubGVuZ3RoLCByID0gYyA8IDMgPyB0YXJnZXQgOiBkZXNjID09PSBudWxsID8gZGVzYyA9IE9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3IodGFyZ2V0LCBrZXkpIDogZGVzYywgZDtcbiAgICBpZiAodHlwZW9mIFJlZmxlY3QgPT09IFwib2JqZWN0XCIgJiYgdHlwZW9mIFJlZmxlY3QuZGVjb3JhdGUgPT09IFwiZnVuY3Rpb25cIikgciA9IFJlZmxlY3QuZGVjb3JhdGUoZGVjb3JhdG9ycywgdGFyZ2V0LCBrZXksIGRlc2MpO1xuICAgIGVsc2UgZm9yICh2YXIgaSA9IGRlY29yYXRvcnMubGVuZ3RoIC0gMTsgaSA+PSAwOyBpLS0pIGlmIChkID0gZGVjb3JhdG9yc1tpXSkgciA9IChjIDwgMyA/IGQocikgOiBjID4gMyA/IGQodGFyZ2V0LCBrZXksIHIpIDogZCh0YXJnZXQsIGtleSkpIHx8IHI7XG4gICAgcmV0dXJuIGMgPiAzICYmIHIgJiYgT2JqZWN0LmRlZmluZVByb3BlcnR5KHRhcmdldCwga2V5LCByKSwgcjtcbn07XG52YXIgX19tZXRhZGF0YSA9ICh0aGlzICYmIHRoaXMuX19tZXRhZGF0YSkgfHwgZnVuY3Rpb24gKGssIHYpIHtcbiAgICBpZiAodHlwZW9mIFJlZmxlY3QgPT09IFwib2JqZWN0XCIgJiYgdHlwZW9mIFJlZmxlY3QubWV0YWRhdGEgPT09IFwiZnVuY3Rpb25cIikgcmV0dXJuIFJlZmxlY3QubWV0YWRhdGEoaywgdik7XG59O1xudmFyIGF1cmVsaWFfZnJhbWV3b3JrXzEgPSByZXF1aXJlKCdhdXJlbGlhLWZyYW1ld29yaycpO1xudmFyIGF1cmVsaWFfcm91dGVyXzEgPSByZXF1aXJlKCdhdXJlbGlhLXJvdXRlcicpO1xudmFyIGF1cmVsaWFfYWRhbF9tYW5hZ2VyXzEgPSByZXF1aXJlKCcuL2F1cmVsaWEtYWRhbC1tYW5hZ2VyJyk7XG5sZXQgQXVyZWxpYUFkYWxBdXRob3JpemVTdGVwID0gY2xhc3Mge1xuICAgIGNvbnN0cnVjdG9yKGF1cmVsaWFBZGFsKSB7XG4gICAgICAgIHRoaXMuYXVyZWxpYUFkYWwgPSBhdXJlbGlhQWRhbDtcbiAgICB9XG4gICAgcnVuKHJvdXRpbmdDb250ZXh0LCBuZXh0KSB7XG4gICAgICAgIGxldCBoYXNoID0gd2luZG93LmxvY2F0aW9uLmhhc2g7XG4gICAgICAgIHJldHVybiB0aGlzLmF1cmVsaWFBZGFsLmhhc2hIYW5kbGVyKGhhc2gsICh1cmwpID0+IHtcbiAgICAgICAgICAgIC8vIFdhcyBjYWxsYmFja1xuICAgICAgICAgICAgcmV0dXJuIG5leHQuY2FuY2VsKG5ldyBhdXJlbGlhX3JvdXRlcl8xLlJlZGlyZWN0KHVybCkpO1xuICAgICAgICB9LCAoKSA9PiB7XG4gICAgICAgICAgICAvLyBXYXMgbm90IGNhbGxiYWNrXG4gICAgICAgICAgICBsZXQgbG9naW5Sb3V0ZSA9ICcnOyAvLyBUT0RPOiBnZXQgbG9naW4gdXJsIGZyb20gYXVyZWxpYUFkYWxcbiAgICAgICAgICAgIGlmIChyb3V0aW5nQ29udGV4dC5nZXRBbGxJbnN0cnVjdGlvbnMoKS5zb21lKGkgPT4gISFpLmNvbmZpZy5zZXR0aW5ncy5yZXF1aXJlQWRhbExvZ2luKSkge1xuICAgICAgICAgICAgICAgIGlmICghdGhpcy5hdXJlbGlhQWRhbC5pc0F1dGhlbnRpY2F0ZWQoKSkge1xuICAgICAgICAgICAgICAgICAgICAvLyBOb3QgbG9nZ2VkIGluLCByZWRpcmVjdCB0byBsb2dpbiByb3V0ZVxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5hdXJlbGlhQWRhbC5sb2dpbkhhbmRsZXIocm91dGluZ0NvbnRleHQuZnJhZ21lbnQsICh1cmwpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBuZXh0LmNhbmNlbChuZXcgYXVyZWxpYV9yb3V0ZXJfMS5SZWRpcmVjdCh1cmwpKTtcbiAgICAgICAgICAgICAgICAgICAgfSwgKCkgPT4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG5leHQuY2FuY2VsKCdsb2dpbiByZWRpcmVjdCcpO1xuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIGlmICh0aGlzLmF1cmVsaWFBZGFsLmlzQXV0aGVudGljYXRlZCgpICYmIHJvdXRpbmdDb250ZXh0LmdldEFsbEluc3RydWN0aW9ucygpLnNvbWUoaSA9PiBpLmZyYWdtZW50ID09IGxvZ2luUm91dGUpKSB7XG4gICAgICAgICAgICAgICAgLy8gTG9nZ2VkIGluLCBjdXJyZW50IHJvdXRlIGlzIHRoZSBsb2dpbiByb3V0ZVxuICAgICAgICAgICAgICAgIGxldCBsb2dpblJlZGlyZWN0ID0gJyc7XG4gICAgICAgICAgICAgICAgcmV0dXJuIG5leHQuY2FuY2VsKG5ldyBhdXJlbGlhX3JvdXRlcl8xLlJlZGlyZWN0KGxvZ2luUmVkaXJlY3QpKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiBuZXh0KCk7XG4gICAgICAgIH0sICgpID0+IHtcbiAgICAgICAgICAgIHJldHVybiBuZXh0KCk7XG4gICAgICAgIH0pO1xuICAgIH1cbn07XG5BdXJlbGlhQWRhbEF1dGhvcml6ZVN0ZXAgPSBfX2RlY29yYXRlKFtcbiAgICBhdXJlbGlhX2ZyYW1ld29ya18xLmluamVjdChhdXJlbGlhX2FkYWxfbWFuYWdlcl8xLkF1cmVsaWFBZGFsTWFuYWdlciksIFxuICAgIF9fbWV0YWRhdGEoJ2Rlc2lnbjpwYXJhbXR5cGVzJywgW2F1cmVsaWFfYWRhbF9tYW5hZ2VyXzEuQXVyZWxpYUFkYWxNYW5hZ2VyXSlcbl0sIEF1cmVsaWFBZGFsQXV0aG9yaXplU3RlcCk7XG5leHBvcnRzLkF1cmVsaWFBZGFsQXV0aG9yaXplU3RlcCA9IEF1cmVsaWFBZGFsQXV0aG9yaXplU3RlcDtcbiIsImltcG9ydCB7aW5qZWN0fSBmcm9tICdhdXJlbGlhLWZyYW1ld29yayc7XHJcbmltcG9ydCB7TmF2aWdhdGlvbkluc3RydWN0aW9uLCBSZWRpcmVjdH0gZnJvbSAnYXVyZWxpYS1yb3V0ZXInO1xyXG5pbXBvcnQge0F1cmVsaWFBZGFsTWFuYWdlcn0gZnJvbSAnLi9hdXJlbGlhLWFkYWwtbWFuYWdlcic7XHJcblxyXG5AaW5qZWN0KEF1cmVsaWFBZGFsTWFuYWdlcilcclxuZXhwb3J0IGNsYXNzIEF1cmVsaWFBZGFsQXV0aG9yaXplU3RlcCB7XHJcbiAgXHJcbiAgY29uc3RydWN0b3IocHJpdmF0ZSBhdXJlbGlhQWRhbDogQXVyZWxpYUFkYWxNYW5hZ2VyKSB7XHJcbiAgICBcclxuICB9XHJcblxyXG4gIHJ1bihyb3V0aW5nQ29udGV4dDogTmF2aWdhdGlvbkluc3RydWN0aW9uLCBuZXh0OiBhbnkpOiB2b2lkIHtcclxuICAgIGxldCBoYXNoID0gd2luZG93LmxvY2F0aW9uLmhhc2g7XHJcblxyXG4gICAgcmV0dXJuIHRoaXMuYXVyZWxpYUFkYWwuaGFzaEhhbmRsZXIoaGFzaCwgKHVybDogc3RyaW5nKSA9PiB7XHJcbiAgICAgIC8vIFdhcyBjYWxsYmFja1xyXG4gICAgICByZXR1cm4gbmV4dC5jYW5jZWwobmV3IFJlZGlyZWN0KHVybCkpO1xyXG4gICAgfSwgKCkgPT4ge1xyXG4gICAgICAvLyBXYXMgbm90IGNhbGxiYWNrXHJcbiAgICAgIGxldCBsb2dpblJvdXRlID0gJyc7IC8vIFRPRE86IGdldCBsb2dpbiB1cmwgZnJvbSBhdXJlbGlhQWRhbFxyXG5cclxuICAgICAgaWYgKHJvdXRpbmdDb250ZXh0LmdldEFsbEluc3RydWN0aW9ucygpLnNvbWUoaSA9PiAhIWkuY29uZmlnLnNldHRpbmdzLnJlcXVpcmVBZGFsTG9naW4pKSB7XHJcbiAgICAgICAgaWYgKCF0aGlzLmF1cmVsaWFBZGFsLmlzQXV0aGVudGljYXRlZCgpKSB7XHJcbiAgICAgICAgICAvLyBOb3QgbG9nZ2VkIGluLCByZWRpcmVjdCB0byBsb2dpbiByb3V0ZVxyXG4gICAgICAgICAgcmV0dXJuIHRoaXMuYXVyZWxpYUFkYWwubG9naW5IYW5kbGVyKHJvdXRpbmdDb250ZXh0LmZyYWdtZW50LCAodXJsOiBzdHJpbmcpID0+IHtcclxuICAgICAgICAgICAgcmV0dXJuIG5leHQuY2FuY2VsKG5ldyBSZWRpcmVjdCh1cmwpKTtcclxuICAgICAgICAgIH0sICgpID0+IHtcclxuICAgICAgICAgICAgcmV0dXJuIG5leHQuY2FuY2VsKCdsb2dpbiByZWRpcmVjdCcpO1xyXG4gICAgICAgICAgfSk7XHJcbiAgICAgICAgfVxyXG4gICAgICB9IGVsc2UgaWYgKHRoaXMuYXVyZWxpYUFkYWwuaXNBdXRoZW50aWNhdGVkKCkgJiYgcm91dGluZ0NvbnRleHQuZ2V0QWxsSW5zdHJ1Y3Rpb25zKCkuc29tZShpID0+IGkuZnJhZ21lbnQgPT0gbG9naW5Sb3V0ZSkpIHtcclxuICAgICAgICAvLyBMb2dnZWQgaW4sIGN1cnJlbnQgcm91dGUgaXMgdGhlIGxvZ2luIHJvdXRlXHJcbiAgICAgICAgbGV0IGxvZ2luUmVkaXJlY3QgPSAnJztcclxuICAgICAgICByZXR1cm4gbmV4dC5jYW5jZWwobmV3IFJlZGlyZWN0KGxvZ2luUmVkaXJlY3QpKTtcclxuICAgICAgfVxyXG5cclxuICAgICAgcmV0dXJuIG5leHQoKTtcclxuICAgICAgfSwgKCkgPT4ge1xyXG4gICAgICAgIHJldHVybiBuZXh0KCk7XHJcbiAgICAgIH0pO1xyXG4gIH1cclxufSJdLCJzb3VyY2VSb290IjoiL3NvdXJjZS8ifQ==
