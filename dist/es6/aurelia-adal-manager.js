var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, Promise, generator) {
    return new Promise(function (resolve, reject) {
        generator = generator.call(thisArg, _arguments);
        function cast(value) { return value instanceof Promise && value.constructor === Promise ? value : new Promise(function (resolve) { resolve(value); }); }
        function onfulfill(value) { try { step("next", value); } catch (e) { reject(e); } }
        function onreject(value) { try { step("throw", value); } catch (e) { reject(e); } }
        function step(verb, value) {
            var result = generator[verb](value);
            result.done ? resolve(result.value) : cast(result.value).then(onfulfill, onreject);
        }
        step("next", void 0);
    });
};
import { inject } from 'aurelia-framework';
import * as Adal from 'adal';
export let AureliaAdalManager = class {
    constructor(adalConstructor) {
        this.adalConstructor = adalConstructor;
        this.oauthData = {
            isAuthenticated: false,
            userName: '',
            loginError: '',
            profile: null
        };
    }
    configure(config) {
        try {
            let configOptions = {};
            configOptions.tenant = config.tenant;
            configOptions.clientId = config.clientId;
            configOptions.endpoints = config.endpoints;
            let existingHash = window.location.hash;
            let pathDefault = window.location.href;
            if (existingHash) {
                pathDefault = pathDefault.replace(existingHash, '');
            }
            configOptions.redirectUri = configOptions.redirectUri || pathDefault;
            configOptions.postLogoutRedirectUri = configOptions.postLogoutRedirectUri || pathDefault;
            this.adal = this.adalConstructor.inject(configOptions);
            window.AuthenticationContext = () => {
                return this.adal;
            };
            this.updateDataFromCache(this.adal.config.loginResource);
        }
        catch (e) {
            console.log(e);
        }
    }
    updateDataFromCache(resource) {
        var token = this.adal.getCachedToken(resource);
        this.oauthData.isAuthenticated = token !== null && token.length > 0;
        var user = this.adal.getCachedUser() || { userName: '', profile: null };
        this.oauthData.userName = user.userName;
        this.oauthData.profile = user.profile;
        this.oauthData.loginError = this.adal.getLoginError();
    }
    hashHandler(hash, redirectHandler, isNotCallbackHandler, nextHandler) {
        if (this.adal.isCallback(hash)) {
            let requestInfo = this.adal.getRequestInfo(hash);
            this.adal.saveTokenFromHash(requestInfo);
            if (requestInfo.requestType !== this.adal.REQUEST_TYPE.LOGIN) {
                this.adal.callback = window.parent.AuthenticationContext().callback;
                if (requestInfo.requestType === this.adal.REQUEST_TYPE.RENEW_TOKEN) {
                    this.adal.callback = window.parent.callBackMappedToRenewStates[requestInfo.stateResponse];
                }
            }
            if (requestInfo.stateMatch) {
                if (typeof this.adal.callback === 'function') {
                    if (requestInfo.requestType === this.adal.REQUEST_TYPE.RENEW_TOKEN) {
                        if (requestInfo.parameters['access_token']) {
                            this.adal.callback(this.adal._getItem(this.adal.CONSTANTS.STORAGE.ERROR_DESCRIPTION), requestInfo.parameters['access_token']);
                            return nextHandler();
                        }
                        else if (requestInfo.parameters['id_token']) {
                            this.adal.callback(this.adal._getItem(this.adal.CONSTANTS.STORAGE.ERROR_DESCRIPTION), requestInfo.parameters['id_token']);
                            return nextHandler();
                        }
                    }
                }
                else {
                    this.updateDataFromCache(this.adal.config.loginResource);
                    if (this.oauthData.userName) {
                        let self = this;
                        self.updateDataFromCache(self.adal.config.loginResource);
                        var loginStartPage = self.adal._getItem(self.adal.CONSTANTS.STORAGE.START_PAGE);
                        if (loginStartPage) {
                            return redirectHandler(loginStartPage);
                        }
                    }
                    else {
                    }
                }
            }
        }
        else {
            return isNotCallbackHandler();
        }
    }
    loginHandler(path, redirectHandler, handler) {
        this.adal.info('Login event for:' + path);
        if (this.adal.config && this.adal.config.localLoginUrl) {
            return redirectHandler(this.adal.config.localLoginUrl);
        }
        else {
            this.adal._saveItem(this.adal.CONSTANTS.STORAGE.START_PAGE, path);
            this.adal.info('Start login at:' + window.location.href);
            this.adal.login();
            return handler();
        }
    }
    config() {
        return this.adal.config;
    }
    login() {
        this.adal.login();
    }
    loginInProgress() {
        return this.adal.loginInProgress();
    }
    logOut() {
        this.adal.logOut();
    }
    getCachedToken(resource) {
        return this.adal.getCachedToken(resource);
    }
    getUserInfo() {
        return this.oauthData;
    }
    acquireToken(resource) {
        return new Promise((resolve, reject) => {
            this.adal.acquireToken(resource, (error, tokenOut) => {
                if (error) {
                    reject(error);
                }
                else {
                    resolve(tokenOut);
                }
            });
        });
    }
    getUser() {
        return __awaiter(this, void 0, Promise, function* () {
            return yield new Promise((resolve, reject) => {
                this.adal.getUser((error, user) => {
                    if (error) {
                        reject(error);
                    }
                    else {
                        resolve(user);
                    }
                });
            });
        });
    }
    getResourceForEndpoint(endpoint) {
        return this.adal.getResourceForEndpoint(endpoint);
    }
    clearCache() {
        this.adal.clearCache();
    }
    clearCacheForResource(resource) {
        this.adal.clearCacheForResource(resource);
    }
    info(message) {
        this.adal.info(message);
    }
    verbose(message) {
        this.adal.verbose(message);
    }
    isAuthenticated() {
        return this.oauthData.isAuthenticated;
    }
};
AureliaAdalManager = __decorate([
    inject(Adal), 
    __metadata('design:paramtypes', [Object])
], AureliaAdalManager);

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImF1cmVsaWEtYWRhbC1tYW5hZ2VyLnRzIl0sIm5hbWVzIjpbIkF1cmVsaWFBZGFsTWFuYWdlciIsIkF1cmVsaWFBZGFsTWFuYWdlci5jb25zdHJ1Y3RvciIsIkF1cmVsaWFBZGFsTWFuYWdlci5jb25maWd1cmUiLCJBdXJlbGlhQWRhbE1hbmFnZXIudXBkYXRlRGF0YUZyb21DYWNoZSIsIkF1cmVsaWFBZGFsTWFuYWdlci5oYXNoSGFuZGxlciIsIkF1cmVsaWFBZGFsTWFuYWdlci5sb2dpbkhhbmRsZXIiLCJBdXJlbGlhQWRhbE1hbmFnZXIuY29uZmlnIiwiQXVyZWxpYUFkYWxNYW5hZ2VyLmxvZ2luIiwiQXVyZWxpYUFkYWxNYW5hZ2VyLmxvZ2luSW5Qcm9ncmVzcyIsIkF1cmVsaWFBZGFsTWFuYWdlci5sb2dPdXQiLCJBdXJlbGlhQWRhbE1hbmFnZXIuZ2V0Q2FjaGVkVG9rZW4iLCJBdXJlbGlhQWRhbE1hbmFnZXIuZ2V0VXNlckluZm8iLCJBdXJlbGlhQWRhbE1hbmFnZXIuYWNxdWlyZVRva2VuIiwiQXVyZWxpYUFkYWxNYW5hZ2VyLmdldFVzZXIiLCJBdXJlbGlhQWRhbE1hbmFnZXIuZ2V0UmVzb3VyY2VGb3JFbmRwb2ludCIsIkF1cmVsaWFBZGFsTWFuYWdlci5jbGVhckNhY2hlIiwiQXVyZWxpYUFkYWxNYW5hZ2VyLmNsZWFyQ2FjaGVGb3JSZXNvdXJjZSIsIkF1cmVsaWFBZGFsTWFuYWdlci5pbmZvIiwiQXVyZWxpYUFkYWxNYW5hZ2VyLnZlcmJvc2UiLCJBdXJlbGlhQWRhbE1hbmFnZXIuaXNBdXRoZW50aWNhdGVkIl0sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O09BQU8sRUFBQyxNQUFNLEVBQUMsTUFBTSxtQkFBbUI7T0FFakMsS0FBSyxJQUFJLE1BQU0sTUFBTTtBQUU1QjtJQVdFQSxZQUFvQkEsZUFBcUJBO1FBQXJCQyxvQkFBZUEsR0FBZkEsZUFBZUEsQ0FBTUE7UUFQakNBLGNBQVNBLEdBQUdBO1lBQ2xCQSxlQUFlQSxF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QUVBLENBQUNBO0lBQ3pCQSxDQUFDQTtJQUVEZixxQkFBcUJBLENBQUNBLFFBQWdCQTtRQUNwQ2dCLElBQUlBLENBQUNBLElBQUlBLENBQUNBLHFCQUFxQkEsQ0FBQ0EsUUFBUUEsQ0FBQ0EsQ0FBQ0E7SUFDNUNBLENBQUNBO0lBRURoQixJQUFJQSxDQUFDQSxPQUFlQTtRQUNsQmlCLElBQUlBLENBQUNBLElBQUlBLENBQUNBLElBQUlBLENBQUNBLE9BQU9BLENBQUNBLENBQUNBO0lBQzFCQSxDQUFDQTtJQUVEakIsT0FBT0EsQ0FBQ0EsT0FBZUE7UUFDckJrQixJQUFJQSxDQUFDQSxJQUFJQSxDQUFDQSxPQUFPQSxDQUFDQSxPQUFPQSxDQUFDQSxDQUFDQTtJQUM3QkEsQ0FBQ0E7SUFHRGxCLGVBQWVBO1FBQ2JtQixNQUFNQSxDQUFDQSxJQUFJQSxDQUFDQSxTQUFTQSxDQUFDQSxlQUFlQSxDQUFDQTtJQUN4Q0EsQ0FBQ0E7QUFDSG5CLENBQUNBO0FBbE1EO0lBQUMsTUFBTSxDQUFDLElBQUksQ0FBQzs7dUJBa01aO0FBQUEiLCJmaWxlIjoiYXVyZWxpYS1hZGFsLW1hbmFnZXIuanMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQge2luamVjdH0gZnJvbSAnYXVyZWxpYS1mcmFtZXdvcmsnO1xyXG5pbXBvcnQge0F1cmVsaWFBZGFsQ29uZmlnfSBmcm9tICcuL2F1cmVsaWEtYWRhbC1jb25maWcnO1xyXG5pbXBvcnQgKiBhcyBBZGFsIGZyb20gJ2FkYWwnO1xyXG5cclxuQGluamVjdChBZGFsKVxyXG5leHBvcnQgY2xhc3MgQXVyZWxpYUFkYWxNYW5hZ2VyIHtcclxuXHJcbiAgcHJpdmF0ZSBhZGFsOiBBZGFsO1xyXG4gIHByaXZhdGUgb2F1dGhEYXRhID0ge1xyXG4gICAgaXNBdXRoZW50aWNhdGVkOiBmYWxzZSxcclxuICAgIHVzZXJOYW1lOiAnJyxcclxuICAgIGxvZ2luRXJyb3I6ICcnLFxyXG4gICAgcHJvZmlsZTogbnVsbFxyXG4gIH1cclxuXHJcbiAgY29uc3RydWN0b3IocHJpdmF0ZSBhZGFsQ29uc3RydWN0b3I6IEFkYWwpIHtcclxuICAgIFxyXG4gIH1cclxuICBcclxuICBjb25maWd1cmUoY29uZmlnOiBBdXJlbGlhQWRhbENvbmZpZykge1xyXG4gICAgdHJ5IHtcclxuICAgICAgbGV0IGNvbmZpZ09wdGlvbnM6IEFkYWxDb25maWcgPSB7fTtcclxuICAgICAgXHJcbiAgICAgIGNvbmZpZ09wdGlvbnMudGVuYW50ID0gY29uZmlnLnRlbmFudDtcclxuICAgICAgY29uZmlnT3B0aW9ucy5jbGllbnRJZCA9IGNvbmZpZy5jbGllbnRJZDtcclxuICAgICAgY29uZmlnT3B0aW9ucy5lbmRwb2ludHMgPSBjb25maWcuZW5kcG9pbnRzO1xyXG5cclxuICAgICAgLy8gcmVkaXJlY3QgYW5kIGxvZ291dF9yZWRpcmVjdCBhcmUgc2V0IHRvIGN1cnJlbnQgbG9jYXRpb24gYnkgZGVmYXVsdFxyXG4gICAgICBsZXQgZXhpc3RpbmdIYXNoID0gd2luZG93LmxvY2F0aW9uLmhhc2g7XHJcbiAgICAgIGxldCBwYXRoRGVmYXVsdCA9IHdpbmRvdy5sb2NhdGlvbi5ocmVmO1xyXG4gICAgICBpZiAoZXhpc3RpbmdIYXNoKSB7XHJcbiAgICAgICAgcGF0aERlZmF1bHQgPSBwYXRoRGVmYXVsdC5yZXBsYWNlKGV4aXN0aW5nSGFzaCwgJycpO1xyXG4gICAgICB9XHJcblxyXG4gICAgICBjb25maWdPcHRpb25zLnJlZGlyZWN0VXJpID0gY29uZmlnT3B0aW9ucy5yZWRpcmVjdFVyaSB8fCBwYXRoRGVmYXVsdDtcclxuICAgICAgY29uZmlnT3B0aW9ucy5wb3N0TG9nb3V0UmVkaXJlY3RVcmkgPSBjb25maWdPcHRpb25zLnBvc3RMb2dvdXRSZWRpcmVjdFVyaSB8fCBwYXRoRGVmYXVsdDtcclxuXHJcbiAgICAgIHRoaXMuYWRhbCA9IHRoaXMuYWRhbENvbnN0cnVjdG9yLmluamVjdChjb25maWdPcHRpb25zKTtcclxuICAgICAgXHJcbiAgICAgIHdpbmRvdy5BdXRoZW50aWNhdGlvbkNvbnRleHQgPSAoKSA9PiB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuYWRhbDtcclxuICAgICAgfVxyXG4gICAgICBcclxuICAgICAgdGhpcy51cGRhdGVEYXRhRnJvbUNhY2hlKHRoaXMuYWRhbC5jb25maWcubG9naW5SZXNvdXJjZSk7XHJcbiAgICB9XHJcbiAgICBjYXRjaCAoZSkge1xyXG4gICAgICBjb25zb2xlLmxvZyhlKTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIHVwZGF0ZURhdGFGcm9tQ2FjaGUocmVzb3VyY2U6IHN0cmluZyk6IHZvaWQge1xyXG4gICAgdmFyIHRva2VuID0gdGhpcy5hZGFsLmdldENhY2hlZFRva2VuKHJlc291cmNlKTtcclxuICAgIHRoaXMub2F1dGhEYXRhLmlzQXV0aGVudGljYXRlZCA9IHRva2VuICE9PSBudWxsICYmIHRva2VuLmxlbmd0aCA+IDA7XHJcbiAgICB2YXIgdXNlciA9IHRoaXMuYWRhbC5nZXRDYWNoZWRVc2VyKCkgfHwgeyB1c2VyTmFtZTogJycsIHByb2ZpbGU6IG51bGwgfTtcclxuICAgIHRoaXMub2F1dGhEYXRhLnVzZXJOYW1lID0gdXNlci51c2VyTmFtZTtcclxuICAgIHRoaXMub2F1dGhEYXRhLnByb2ZpbGUgPSB1c2VyLnByb2ZpbGU7XHJcbiAgICB0aGlzLm9hdXRoRGF0YS5sb2dpbkVycm9yID0gdGhpcy5hZGFsLmdldExvZ2luRXJyb3IoKTtcclxuICB9XHJcblxyXG4gIGhhc2hIYW5kbGVyKGhhc2g6IHN0cmluZywgcmVkaXJlY3RIYW5kbGVyOiBGdW5jdGlvbiwgaXNOb3RDYWxsYmFja0hhbmRsZXI6IEZ1bmN0aW9uLCBuZXh0SGFuZGxlcjogRnVuY3Rpb24pOiB2b2lkIHtcclxuICAgIGlmICh0aGlzLmFkYWwuaXNDYWxsYmFjayhoYXNoKSkge1xyXG4gICAgICBsZXQgcmVxdWVzdEluZm8gPSB0aGlzLmFkYWwuZ2V0UmVxdWVzdEluZm8oaGFzaCk7XHJcbiAgICAgIFxyXG4gICAgICB0aGlzLmFkYWwuc2F2ZVRva2VuRnJvbUhhc2gocmVxdWVzdEluZm8pO1xyXG5cclxuICAgICAgaWYgKHJlcXVlc3RJbmZvLnJlcXVlc3RUeXBlICE9PSB0aGlzLmFkYWwuUkVRVUVTVF9UWVBFLkxPR0lOKSB7XHJcbiAgICAgICAgdGhpcy5hZGFsLmNhbGxiYWNrID0gd2luZG93LnBhcmVudC5BdXRoZW50aWNhdGlvbkNvbnRleHQoKS5jYWxsYmFjaztcclxuICAgICAgICBpZiAocmVxdWVzdEluZm8ucmVxdWVzdFR5cGUgPT09IHRoaXMuYWRhbC5SRVFVRVNUX1RZUEUuUkVORVdfVE9LRU4pIHtcclxuICAgICAgICAgIHRoaXMuYWRhbC5jYWxsYmFjayA9IHdpbmRvdy5wYXJlbnQuY2FsbEJhY2tNYXBwZWRUb1JlbmV3U3RhdGVzW3JlcXVlc3RJbmZvLnN0YXRlUmVzcG9uc2VdO1xyXG4gICAgICAgIH1cclxuICAgICAgfVxyXG5cclxuICAgICAgLy8gUmV0dXJuIHRvIGNhbGxiYWNrIGlmIGl0IGlzIHNlbnQgZnJvbSBpZnJhbWVcclxuICAgICAgaWYgKHJlcXVlc3RJbmZvLnN0YXRlTWF0Y2gpIHtcclxuICAgICAgICBpZiAodHlwZW9mIHRoaXMuYWRhbC5jYWxsYmFjayA9PT0gJ2Z1bmN0aW9uJykge1xyXG4gICAgICAgICAgLy8gQ2FsbCB3aXRoaW4gdGhlIHNhbWUgY29udGV4dCB3aXRob3V0IGZ1bGwgcGFnZSByZWRpcmVjdCBrZWVwcyB0aGUgY2FsbGJhY2tcclxuICAgICAgICAgIGlmIChyZXF1ZXN0SW5mby5yZXF1ZXN0VHlwZSA9PT0gdGhpcy5hZGFsLlJFUVVFU1RfVFlQRS5SRU5FV19UT0tFTikge1xyXG4gICAgICAgICAgICAvLyBJZHRva2VuIG9yIEFjY2VzdG9rZW4gY2FuIGJlIHJlbmV3ZWRcclxuICAgICAgICAgICAgaWYgKHJlcXVlc3RJbmZvLnBhcmFtZXRlcnNbJ2FjY2Vzc190b2tlbiddKSB7XHJcbiAgICAgICAgICAgICAgdGhpcy5hZGFsLmNhbGxiYWNrKHRoaXMuYWRhbC5fZ2V0SXRlbSh0aGlzLmFkYWwuQ09OU1RBTlRTLlNUT1JBR0UuRVJST1JfREVTQ1JJUFRJT04pLCByZXF1ZXN0SW5mby5wYXJhbWV0ZXJzWydhY2Nlc3NfdG9rZW4nXSk7XHJcbiAgICAgICAgICAgICAgcmV0dXJuIG5leHRIYW5kbGVyKCk7XHJcbiAgICAgICAgICAgIH0gZWxzZSBpZiAocmVxdWVzdEluZm8ucGFyYW1ldGVyc1snaWRfdG9rZW4nXSkge1xyXG4gICAgICAgICAgICAgIHRoaXMuYWRhbC5jYWxsYmFjayh0aGlzLmFkYWwuX2dldEl0ZW0odGhpcy5hZGFsLkNPTlNUQU5UUy5TVE9SQUdFLkVSUk9SX0RFU0NSSVBUSU9OKSwgcmVxdWVzdEluZm8ucGFyYW1ldGVyc1snaWRfdG9rZW4nXSk7XHJcbiAgICAgICAgICAgICAgcmV0dXJuIG5leHRIYW5kbGVyKCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgIH1cclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgLy8gbm9ybWFsIGZ1bGwgbG9naW4gcmVkaXJlY3QgaGFwcGVuZWQgb24gdGhlIHBhZ2VcclxuICAgICAgICAgIHRoaXMudXBkYXRlRGF0YUZyb21DYWNoZSh0aGlzLmFkYWwuY29uZmlnLmxvZ2luUmVzb3VyY2UpO1xyXG4gICAgICAgICAgaWYgKHRoaXMub2F1dGhEYXRhLnVzZXJOYW1lKSB7XHJcbiAgICAgICAgICAgIC8vSUR0b2tlbiBpcyBhZGRlZCBhcyB0b2tlbiBmb3IgdGhlIGFwcFxyXG4gICAgICAgICAgICBsZXQgc2VsZiA9IHRoaXM7XHJcblxyXG4gICAgICAgICAgICBzZWxmLnVwZGF0ZURhdGFGcm9tQ2FjaGUoc2VsZi5hZGFsLmNvbmZpZy5sb2dpblJlc291cmNlKTtcclxuICAgICAgICAgICAgLy8gcmVkaXJlY3QgdG8gbG9naW4gcmVxdWVzdGVkIHBhZ2VcclxuICAgICAgICAgICAgdmFyIGxvZ2luU3RhcnRQYWdlID0gc2VsZi5hZGFsLl9nZXRJdGVtKHNlbGYuYWRhbC5DT05TVEFOVFMuU1RPUkFHRS5TVEFSVF9QQUdFKTtcclxuICAgICAgICAgICAgaWYgKGxvZ2luU3RhcnRQYWdlKSB7XHJcbiAgICAgICAgICAgICAgcmV0dXJuIHJlZGlyZWN0SGFuZGxlcihsb2dpblN0YXJ0UGFnZSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgLy8gVE9ETzogYnJvYWRjYXN0IGxvZ2luIHN1Y2Nlc3M/XHJcbiAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAvLyBUT0RPOiBicm9hZGNhc3QgbG9naW4gZmFpbHVyZT8gKHJlYXNvbjogdGhpcy5hZGFsLl9nZXRJdGVtKHRoaXMuYWRhbC5DT05TVEFOVFMuU1RPUkFHRS5FUlJPUl9ERVNDUklQVElPTikpXHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICB9XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICByZXR1cm4gaXNOb3RDYWxsYmFja0hhbmRsZXIoKTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIGxvZ2luSGFuZGxlcihwYXRoOiBzdHJpbmcsIHJlZGlyZWN0SGFuZGxlcjogRnVuY3Rpb24sIGhhbmRsZXI6IEZ1bmN0aW9uKSB7XHJcbiAgICB0aGlzLmFkYWwuaW5mbygnTG9naW4gZXZlbnQgZm9yOicgKyBwYXRoKTtcclxuXHJcbiAgICBpZiAodGhpcy5hZGFsLmNvbmZpZyAmJiB0aGlzLmFkYWwuY29uZmlnLmxvY2FsTG9naW5VcmwpIHtcclxuICAgICAgcmV0dXJuIHJlZGlyZWN0SGFuZGxlcih0aGlzLmFkYWwuY29uZmlnLmxvY2FsTG9naW5VcmwpO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgLy8gZGlyZWN0bHkgc3RhcnQgbG9naW4gZmxvd1xyXG4gICAgICB0aGlzLmFkYWwuX3NhdmVJdGVtKHRoaXMuYWRhbC5DT05TVEFOVFMuU1RPUkFHRS5TVEFSVF9QQUdFLCBwYXRoKTtcclxuICAgICAgdGhpcy5hZGFsLmluZm8oJ1N0YXJ0IGxvZ2luIGF0OicgKyB3aW5kb3cubG9jYXRpb24uaHJlZik7XHJcbiAgICAgIC8vIFRPRE86IGJyb2FkY2FzdCBsb2dpbiByZWRpcmVjdD9cclxuICAgICAgdGhpcy5hZGFsLmxvZ2luKCk7XHJcbiAgICAgIHJldHVybiBoYW5kbGVyKCk7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICBjb25maWcoKTogQWRhbENvbmZpZyB7XHJcbiAgICByZXR1cm4gdGhpcy5hZGFsLmNvbmZpZztcclxuICB9XHJcblxyXG4gIGxvZ2luKCkge1xyXG4gICAgdGhpcy5hZGFsLmxvZ2luKCk7XHJcbiAgfVxyXG5cclxuICBsb2dpbkluUHJvZ3Jlc3MoKTogYm9vbGVhbiB7XHJcbiAgICByZXR1cm4gdGhpcy5hZGFsLmxvZ2luSW5Qcm9ncmVzcygpO1xyXG4gIH1cclxuXHJcbiAgbG9nT3V0KCkge1xyXG4gICAgdGhpcy5hZGFsLmxvZ091dCgpO1xyXG4gIH1cclxuXHJcbiAgZ2V0Q2FjaGVkVG9rZW4ocmVzb3VyY2U6IHN0cmluZyk6IHN0cmluZyB7XHJcbiAgICByZXR1cm4gdGhpcy5hZGFsLmdldENhY2hlZFRva2VuKHJlc291cmNlKTtcclxuICB9XHJcblxyXG4gIGdldFVzZXJJbmZvKCk6IGFueSB7XHJcbiAgICByZXR1cm4gdGhpcy5vYXV0aERhdGE7XHJcbiAgfVxyXG5cclxuICBhY3F1aXJlVG9rZW4ocmVzb3VyY2U6IHN0cmluZyk6IFByb21pc2U8c3RyaW5nPiB7XHJcbiAgICAvLyBhdXRvbWF0ZWQgdG9rZW4gcmVxdWVzdCBjYWxsXHJcbiAgICByZXR1cm4gbmV3IFByb21pc2U8c3RyaW5nPigocmVzb2x2ZSwgcmVqZWN0KSA9PiB7XHJcbiAgICAgIHRoaXMuYWRhbC5hY3F1aXJlVG9rZW4ocmVzb3VyY2UsIChlcnJvcjogc3RyaW5nLCB0b2tlbk91dDogc3RyaW5nKSA9PiB7XHJcbiAgICAgICAgaWYgKGVycm9yKSB7XHJcbiAgICAgICAgICByZWplY3QoZXJyb3IpO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICByZXNvbHZlKHRva2VuT3V0KTtcclxuICAgICAgICB9XHJcbiAgICAgIH0pO1xyXG4gICAgfSk7XHJcbiAgfVxyXG5cclxuICBhc3luYyBnZXRVc2VyKCk6IFByb21pc2U8VXNlcj4ge1xyXG4gICAgcmV0dXJuIGF3YWl0IG5ldyBQcm9taXNlPFVzZXI+KChyZXNvbHZlLCByZWplY3QpID0+IHtcclxuICAgICAgdGhpcy5hZGFsLmdldFVzZXIoKGVycm9yOiBzdHJpbmcsIHVzZXI6IFVzZXIpID0+IHtcclxuICAgICAgICBpZiAoZXJyb3IpIHtcclxuICAgICAgICAgIHJlamVjdChlcnJvcik7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgIHJlc29sdmUodXNlcik7XHJcbiAgICAgICAgfVxyXG4gICAgICB9KTtcclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgZ2V0UmVzb3VyY2VGb3JFbmRwb2ludChlbmRwb2ludDogc3RyaW5nKTogc3RyaW5nIHtcclxuICAgIHJldHVybiB0aGlzLmFkYWwuZ2V0UmVzb3VyY2VGb3JFbmRwb2ludChlbmRwb2ludCk7XHJcbiAgfVxyXG5cclxuICBjbGVhckNhY2hlKCkge1xyXG4gICAgdGhpcy5hZGFsLmNsZWFyQ2FjaGUoKTtcclxuICB9XHJcblxyXG4gIGNsZWFyQ2FjaGVGb3JSZXNvdXJjZShyZXNvdXJjZTogc3RyaW5nKSB7XHJcbiAgICB0aGlzLmFkYWwuY2xlYXJDYWNoZUZvclJlc291cmNlKHJlc291cmNlKTtcclxuICB9XHJcblxyXG4gIGluZm8obWVzc2FnZTogc3RyaW5nKSB7XHJcbiAgICB0aGlzLmFkYWwuaW5mbyhtZXNzYWdlKTtcclxuICB9XHJcblxyXG4gIHZlcmJvc2UobWVzc2FnZTogc3RyaW5nKSB7XHJcbiAgICB0aGlzLmFkYWwudmVyYm9zZShtZXNzYWdlKTtcclxuICB9XHJcblxyXG5cclxuICBpc0F1dGhlbnRpY2F0ZWQoKSB7XHJcbiAgICByZXR1cm4gdGhpcy5vYXV0aERhdGEuaXNBdXRoZW50aWNhdGVkO1xyXG4gIH1cclxufSJdLCJzb3VyY2VSb290IjoiL3NvdXJjZS8ifQ==
